$(function() {
    var addActiveClassToNav = function() {
        var pathName = document.location.pathname,
            activePath = pathName.split('/')[1],
            activeNavLink = $('nav ul li a[href="/' + activePath + '"]');

        $('nav ul li').removeClass('active');
        activeNavLink.parent().addClass('active');
    };

    addActiveClassToNav();
    hljs.initHighlightingOnLoad();
    $('table.oskari-sortable').stupidtable();
});
var Manager;

(function ($) {

  $(function () {
    Manager = new AjaxSolr.Manager({
      solrUrl: 'http://localhost:8983/solr/'
    });
    Manager.addWidget(new AjaxSolr.ResultWidget({
      id: 'result',
      target: '/views/search/docs'
    }));
    Manager.init();
    Manager.store.addByValue('q', '*:*');
    Manager.doRequest();
  });

// The afterRequest method empties the target HTML element and appends HTML content to it for each document in the Solr response.
// Määrittele target?

// Note: If you are using your own Solr instance, you may need to change the template method to match your own Solr fields: 
// specifically, doc.text, doc.dateline, doc.title and doc.id.

afterRequest: function () {
  $(this.target).empty();
  for (var i = 0, l = this.manager.response.response.docs.length; i < l; i++) {
    var doc = this.manager.response.response.docs[i];
    $(this.target).append(this.template(doc));
  }
},

template: function (doc) {
  var snippet = '';
  if (doc.text.length > 300) {
    snippet += doc.dateline + ' ' + doc.text.substring(0, 300);
    snippet += '<span style="display:none;">' + doc.text.substring(300);
    snippet += '</span> <a href="#" class="more">more</a>';
  }
  else {
    snippet += doc.dateline + ' ' + doc.text;
  }

  var output = '<div><h2>' + doc.title + '</h2>';
  output += '<p id="links_' + doc.id + '" class="links"></p>';
  output += '<p>' + snippet + '</p></div>';
  return output;
}

})(jQuery);